#!/bin/bash

# Имя выходного файла, в который будут объединены все .kt файлы
OUTPUT_FILE="merged_kotlin_files.txt"

# Директория, в которой будет производиться поиск .kt файлов (по умолчанию текущая)
# Если хотите указать другую, измените значение или передайте как первый аргумент скрипту
# Например: ./merge_kt.sh ./src/main/kotlin
SOURCE_DIR="${1:-.}" # Используем первый аргумент или "." (текущая директория) по умолчанию

# Проверка, существует ли указанная директория
if [ ! -d "$SOURCE_DIR" ]; then
    echo "Ошибка: Директория '$SOURCE_DIR' не найдена."
    exit 1
fi

echo "Поиск .kt файлов в директории: '$SOURCE_DIR'"
echo "Объединение в файл: '$OUTPUT_FILE'"

# Создаем или очищаем выходной файл перед записью
> "$OUTPUT_FILE" # Это создаст пустой файл или очистит существующий

# Находим все файлы с расширением .kt в указанной директории и ее поддиректориях
# -print0 и read -r -d $'\0' используются для корректной обработки имен файлов
# с пробелами или специальными символами.
find "$SOURCE_DIR" -type f -name "*.kt" -print0 | while IFS= read -r -d $'\0' kt_file; do
    echo "Добавляется файл: $kt_file"

    # Добавляем комментарий с именем исходного файла в объединенный файл
    echo "" >> "$OUTPUT_FILE" # Пустая строка для разделения
    echo "// --- Начало файла: $kt_file ---" >> "$OUTPUT_FILE"
    echo "" >> "$OUTPUT_FILE"

    # Добавляем содержимое текущего .kt файла в выходной файл
    cat "$kt_file" >> "$OUTPUT_FILE"

    # Добавляем комментарий об окончании файла
    echo "" >> "$OUTPUT_FILE"
    echo "// --- Конец файла: $kt_file ---" >> "$OUTPUT_FILE"
    echo "" >> "$OUTPUT_FILE" # Еще одна пустая строка для лучшей читаемости
done

# Проверка, был ли выходной файл создан (например, если .kt файлы не найдены)
if [ ! -s "$OUTPUT_FILE" ]; then
    # Если файл существует, но пуст (например, не было найдено .kt файлов)
    # или если `find` ничего не нашел и цикл не выполнился
    # (хотя `> "$OUTPUT_FILE"` создаст его)
    # Добавим сюда проверку на случай, если `find` ничего не нашел
    count_files=$(find "$SOURCE_DIR" -type f -name "*.kt" | wc -l)
    if [ "$count_files" -eq 0 ]; then
        echo "Предупреждение: .kt файлы не найдены в '$SOURCE_DIR'. Создан пустой '$OUTPUT_FILE'."
    else
        echo "Завершено. Все .kt файлы объединены в '$OUTPUT_FILE'"
    fi
else
     echo "Завершено. Все .kt файлы объединены в '$OUTPUT_FILE'"
fi

# Конец скрипта
